<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>PWA NotificaÃ§Ãµes ðŸ””</title>
    <link rel="manifest" href="manifest.json">
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-messaging-compat.js"></script>

    <style>
        body { font-family: sans-serif; margin: 0; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        #btn-notificacao {
            background: #ff9f43; color: white; border: none; padding: 20px;
            border-radius: 12px; font-weight: bold; font-size: 1.1rem; cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .status { margin-top: 20px; color: #555; font-size: 0.9rem; }
    </style>
</head>
<body>

    <button id="btn-notificacao" onclick="ativarNotificacoes()">ðŸ”” ATIVAR NOTIFICAÃ‡Ã•ES</button>
    <div id="status" class="status">Clique acima para comeÃ§ar</div>

    <script>
        // 1. Sua configuraÃ§Ã£o que vocÃª postou
        const firebaseConfig = {
          apiKey: "AIzaSyAsK3kEuustv7KyoQXR0Ep-whTpDCDa03w",
          authDomain: "manuu-c23a7.firebaseapp.com",
          databaseURL: "https://manuu-c23a7-default-rtdb.firebaseio.com",
          projectId: "manuu-c23a7",
          storageBucket: "manuu-c23a7.firebasestorage.app",
          messagingSenderId: "378235951611",
          appId: "1:378235951611:web:72c855fbb5ccdb1a84535e",
          measurementId: "G-2V1EXW1794"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const messaging = firebase.messaging();

        async function ativarNotificacoes() {
            const statusDiv = document.getElementById('status');
            statusDiv.innerText = "Pedindo permissÃ£o...";

            try {
                const permission = await Notification.requestPermission();
                if (permission === 'granted') {
                    // 2. Sua chave VAPID que vocÃª mandou agora
                    const token = await messaging.getToken({ 
                        vapidKey: 'BPn6ATIl_Rjnxsn8yiRCQBZ2XtisDs5qIW6hiq391z6YTYEtKyY9OQfVAgs2y6v3siAamzjyRDjTMrDSzbm9uY0' 
                    });
                    
                    if (token) {
                        console.log("Token:", token);
                        // Salva no Firebase para podermos enviar a mensagem depois
                        await db.ref('tokens_pwa').child('meu_aparelho').set(token);
                        statusDiv.innerText = "âœ… NotificaÃ§Ãµes Ativas!";
                        alert("Pronto! Seu celular jÃ¡ pode receber avisos.");
                    }
                } else {
                    statusDiv.innerText = "âŒ PermissÃ£o negada pelo usuÃ¡rio.";
                }
            } catch (error) {
                console.error(error);
                statusDiv.innerText = "Erro: " + error.message;
            }
        }

        // Registro do Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').then((reg) => {
                messaging.useServiceWorker(reg);
            });
        }
    </script>
</body>
</html>
